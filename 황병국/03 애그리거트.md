# 애그리거트와 애그리거트 루트

---

## 애그리거트(Aggregate)

- **상위 수준의 개념**으로 전체 모델을 정리하면, 전반적인 관계를 이해하는 데 도움이 된다.
- 복잡한 도메인을 관리 가능한 단위로 나누려면, 상위 수준에서 모델을 **조망할 수 있는 방법**이 필요한데, 그 방법이 바로 애그리거트다.
- 애그리거트는 **관련된 객체들을 하나의 군**으로 묶어 준다.
- 수많은 객체를 애그리거트 단위로 묶어 보면, **도메인 모델 간의 관계를 상위 수준에서 파악**할 수 있다.
- 애그리거트는 관련된 모델을 한데 모으므로, **같은 애그리거트에 속한 객체들은 유사하거나 동일한 라이프사이클**을 갖는다.
- 함께 변경되는 빈도가 높은 객체는 하나의 애그리거트에 속할 가능성이 높다.

---

## 애그리거트 루트(Aggregate Root)

- 애그리거트에 속한 모든 객체가 **일관된 상태를 유지**하려면, 애그리거트 전체를 관리할 주체가 필요하다. 이 책임을 지는 것이 **애그리거트 루트 엔티티**다.
- 애그리거트 루트가 제공하는 메서드는 **도메인 규칙을 준수하며**, 애그리거트 내 객체들의 일관성이 깨지지 않도록 구현해야 한다.
- **애그리거트 외부에서 애그리거트 내부 객체를 직접 변경해서는 안 된다.**
  - 루트를 거치지 않으면, 애그리거트 루트가 강제하는 규칙을 적용할 수 없어 모델의 일관성이 깨질 수 있다.

---

## 트랜잭션과 애그리거트

- **하나의 트랜잭션에서 한 개의 애그리거트만 수정해야 한다.**
- 한 트랜잭션에서 두 개 이상의 애그리거트를 수정하면 **트랜잭션 충돌 가능성이 높아지고**, 동시에 전체 처리량도 떨어질 수 있다.
- 따라서 한 번에 수정하는 애그리거트의 수가 많아질수록 시스템의 성능은 저하된다.

---

## ID를 이용한 애그리거트 참조

- 한 애그리거트 내부에서 **다른 애그리거트 객체에 직접 접근할 수 있도록 하면 안 된다.**
- 다른 애그리거트의 상태를 직접 변경할 수 있게 되면, 각 애그리거트가 관리해야 할 경계를 침범하게 된다.
- 트랜잭션 범위와 마찬가지로, **애그리거트가 관리하는 범위는 자기 자신으로 한정**해야 한다.
